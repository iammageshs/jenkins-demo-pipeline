steps:
# Step to check out the source code from the repository
- name: 'gcr.io/cloud-builders/git'
  args: ['clone', '--single-branch', '--branch', '${_BRANCH}', '--', 'https://github.com/your/repository.git', '.']
  env:
    - '_BRANCH=${BRANCH_NAME}'

# Step to build the Maven project
- name: 'maven:3.6.3-jdk-11-slim'
  entrypoint: 'mvn'
  args: ['clean', 'install']

# Optional: define substitutions for triggering builds on different branches/tags
substitutions:
  _BRANCH: "master"

  options:
  logging: CLOUD_LOGGING_ONLY

# Docker build and push
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/grafana-monitoring-demo/cloud-build-repo/demo:$COMMIT_SHA', '-f', 'Dockerfile', '.']
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/grafana-monitoring-demo/cloud-build-repo/demo:$COMMIT_SHA']

# Deploy container image to Cloud Run
- name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
  entrypoint: gcloud
  args: ['run', 'deploy', 'demo-service', '--image', 'gcr.io/grafana-monitoring-demo/cloud-build-repo/demo:$COMMIT_SHA', '--region', 'asia-south1']
images:
- gcr.io/grafana-monitoring-demo/cloud-build-repo/demo:$COMMIT_SHA


